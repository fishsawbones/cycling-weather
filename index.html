<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Cycling Weather Gear</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 40px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .temp-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }

        .weather-details {
            text-align: right;
        }

        .weather-details div {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .location {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .conditions {
            font-size: 14px;
            color: #666;
            text-transform: capitalize;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .subsection-title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .gear-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .gear-category {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .gear-recommendation {
            color: #555;
            font-size: 14px;
        }

        .alert {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .alert.danger {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .alert.info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }

        .refresh-btn:active {
            background: #5568d3;
        }

        .wind-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wind-arrow {
            display: inline-block;
            font-size: 20px;
        }

        .hourly-forecast {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .hourly-item {
            min-width: 80px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            flex-shrink: 0;
        }

        .hourly-time {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 5px;
            color: #667eea;
        }

        .hourly-temp {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .hourly-details {
            font-size: 11px;
            color: #666;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .info-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .info-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .uv-low { color: #2ecc71; }
        .uv-moderate { color: #f39c12; }
        .uv-high { color: #e67e22; }
        .uv-very-high { color: #e74c3c; }
        .uv-extreme { color: #8e44ad; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö¥ Cycling Weather</h1>
            <p>What to wear for your ride</p>
        </div>

        <div id="app">
            <div class="loading">Loading weather data...</div>
        </div>
    </div>

    <script>
        const LUBBOCK_COORDS = { lat: 33.5779, lon: -101.8552 };

        async function getWeather(lat, lon) {
            const response = await fetch(
                `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_direction_10m,wind_gusts_10m,relative_humidity_2m&hourly=temperature_2m,apparent_temperature,precipitation_probability,weather_code,wind_speed_10m,wind_gusts_10m&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max,precipitation_probability_max&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto&forecast_days=2`
            );
            return await response.json();
        }

        async function getLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            resolve({
                                lat: position.coords.latitude,
                                lon: position.coords.longitude,
                                name: 'Your Location'
                            });
                        },
                        () => {
                            resolve({
                                ...LUBBOCK_COORDS,
                                name: 'Lubbock, TX'
                            });
                        }
                    );
                } else {
                    resolve({
                        ...LUBBOCK_COORDS,
                        name: 'Lubbock, TX'
                    });
                }
            });
        }

        function getWeatherDescription(code) {
            const weatherCodes = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Foggy',
                51: 'Light drizzle',
                53: 'Drizzle',
                55: 'Heavy drizzle',
                61: 'Light rain',
                63: 'Rain',
                65: 'Heavy rain',
                71: 'Light snow',
                73: 'Snow',
                75: 'Heavy snow',
                80: 'Rain showers',
                95: 'Thunderstorm'
            };
            return weatherCodes[code] || 'Unknown';
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        function getWindArrow(degrees) {
            const rotation = degrees + 180;
            return `<span style="display: inline-block; transform: rotate(${rotation}deg);">‚Üë</span>`;
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            const hours = date.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}${ampm}`;
        }

        function formatSunTime(dateString) {
            const date = new Date(dateString);
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:${minutes.toString().padStart(2, '0')}${ampm}`;
        }

        function getUVLevel(uvIndex) {
            if (uvIndex < 3) return { level: 'Low', class: 'uv-low' };
            if (uvIndex < 6) return { level: 'Moderate', class: 'uv-moderate' };
            if (uvIndex < 8) return { level: 'High', class: 'uv-high' };
            if (uvIndex < 11) return { level: 'Very High', class: 'uv-very-high' };
            return { level: 'Extreme', class: 'uv-extreme' };
        }

        function getHourlyForecast(weather) {
            const now = new Date();
            const currentHour = now.getHours();
            const hourly = weather.hourly;
            const forecast = [];

            for (let i = 0; i < 6; i++) {
                const hour = currentHour + i;
                if (hour < 24) {
                    forecast.push({
                        time: hourly.time[hour],
                        temp: Math.round(hourly.temperature_2m[hour]),
                        feelsLike: Math.round(hourly.apparent_temperature[hour]),
                        precipProb: hourly.precipitation_probability[hour],
                        windSpeed: Math.round(hourly.wind_speed_10m[hour]),
                        windGust: Math.round(hourly.wind_gusts_10m[hour]),
                        weatherCode: hourly.weather_code[hour]
                    });
                }
            }

            return forecast;
        }

        function getGearRecommendations(temp, feelsLike, windSpeed, precipitation, weatherCode, humidity) {
            const recommendations = {
                upperBody: '',
                lowerBody: '',
                gloves: '',
                footwear: '',
                accessories: []
            };

            const alerts = [];

            const effectiveTemp = temp < 60 ? feelsLike : temp;

            // Calculate heat index for hot weather
            if (temp > 75 && humidity > 40) {
                const heatIndex = -42.379 + 2.04901523 * temp + 10.14333127 * humidity 
                    - 0.22475541 * temp * humidity - 0.00683783 * temp * temp 
                    - 0.05481717 * humidity * humidity + 0.00122874 * temp * temp * humidity 
                    + 0.00085282 * temp * humidity * humidity - 0.00000199 * temp * temp * humidity * humidity;
                
                if (heatIndex > 90) {
                    alerts.push('üå°Ô∏è Heat index ' + Math.round(heatIndex) + '¬∞F - high risk of heat exhaustion. Hydrate frequently!');
                }
            }

            // UPPER BODY
            if (effectiveTemp < 25) {
                recommendations.upperBody = 'Base layer + thermal jersey + winter jacket (insulated, windproof)';
            } else if (effectiveTemp < 35) {
                recommendations.upperBody = 'Base layer + long sleeve jersey + winter jacket';
            } else if (effectiveTemp < 45) {
                recommendations.upperBody = 'Base layer + long sleeve jersey + windproof jacket';
            } else if (effectiveTemp < 55) {
                recommendations.upperBody = 'Long sleeve jersey + windproof vest or jacket';
            } else if (effectiveTemp < 65) {
                recommendations.upperBody = 'Long sleeve jersey or short sleeve + arm warmers';
            } else if (effectiveTemp < 75) {
                recommendations.upperBody = 'Short sleeve jersey';
            } else {
                recommendations.upperBody = 'Lightweight/mesh jersey';
                recommendations.accessories.push('Extra water bottle');
                recommendations.accessories.push('Sunscreen');
            }

            // LOWER BODY
            if (effectiveTemp < 30) {
                recommendations.lowerBody = 'Thermal tights (windproof front)';
            } else if (effectiveTemp < 40) {
                recommendations.lowerBody = 'Thermal tights or knickers + leg warmers';
            } else if (effectiveTemp < 50) {
                recommendations.lowerBody = 'Knickers or shorts + leg warmers';
            } else if (effectiveTemp < 60) {
                recommendations.lowerBody = 'Shorts + knee warmers or light leg warmers';
            } else {
                recommendations.lowerBody = 'Cycling shorts/bibs';
            }

            // GLOVES
            if (effectiveTemp < 20) {
                recommendations.gloves = 'Lobster mitts or pogies';
                alerts.push('‚ö†Ô∏è Extreme cold - consider shortening ride or indoor trainer');
            } else if (effectiveTemp < 30) {
                recommendations.gloves = 'Winter gloves (insulated, windproof)';
            } else if (effectiveTemp < 40) {
                recommendations.gloves = 'Heavy winter gloves';
            } else if (effectiveTemp < 50) {
                recommendations.gloves = 'Light winter gloves or windproof gloves';
            } else if (effectiveTemp < 60) {
                recommendations.gloves = 'Light full-finger gloves';
            } else if (effectiveTemp < 70) {
                recommendations.gloves = 'Fingerless gloves (optional)';
            } else {
                recommendations.gloves = 'None needed (or fingerless for padding)';
            }

            // FOOTWEAR
            if (effectiveTemp < 30) {
                recommendations.footwear = 'Winter cycling boots + wool socks';
            } else if (effectiveTemp < 40) {
                recommendations.footwear = 'Shoe covers (neoprene/insulated) + wool socks';
            } else if (effectiveTemp < 50) {
                recommendations.footwear = 'Toe covers or light shoe covers';
            } else if (effectiveTemp < 60) {
                recommendations.footwear = 'Regular shoes (consider toe covers)';
            } else {
                recommendations.footwear = 'Regular cycling shoes';
            }

            // ACCESSORIES
            if (effectiveTemp < 40) {
                recommendations.accessories.push('Neck gaiter or balaclava');
                recommendations.accessories.push('Skull cap under helmet');
            } else if (effectiveTemp < 50) {
                recommendations.accessories.push('Ear warmers or headband');
            }

            if (windSpeed > 20) {
                alerts.push('‚ö†Ô∏è High winds - expect significant wind chill and difficult riding');
                if (!recommendations.upperBody.includes('windproof')) {
                    recommendations.accessories.push('Consider windproof layer');
                }
            } else if (windSpeed > 15) {
                alerts.push('Moderate winds - wind chill will be significant');
            }

            if (precipitation > 0 || weatherCode >= 51) {
                recommendations.accessories.push('Rain jacket or vest');
                recommendations.accessories.push('Fenders recommended');
                if (weatherCode >= 61) {
                    alerts.push('üåßÔ∏è Rain expected - wear waterproof layers');
                }
            }

            if (weatherCode >= 71 && weatherCode <= 75) {
                alerts.push('‚ùÑÔ∏è Snow conditions - consider indoor trainer');
            }

            if (temp > 85) {
                alerts.push('üå°Ô∏è High heat - hydrate well, consider earlier/later ride time');
            }

            return { recommendations, alerts };
        }

        async function loadApp() {
            const app = document.getElementById('app');
            
            try {
                const location = await getLocation();
                const weather = await getWeather(location.lat, location.lon);
                
                const current = weather.current;
                const daily = weather.daily;
                
                const temp = Math.round(current.temperature_2m);
                const feelsLike = Math.round(current.apparent_temperature);
                const windSpeed = Math.round(current.wind_speed_10m);
                const windGust = Math.round(current.wind_gusts_10m);
                const windDir = getWindDirection(current.wind_direction_10m);
                const windArrow = getWindArrow(current.wind_direction_10m);
                const precipitation = current.precipitation || 0;
                const humidity = Math.round(current.relative_humidity_2m);
                const weatherCode = current.weather_code;
                const conditions = getWeatherDescription(weatherCode);
                const highTemp = Math.round(daily.temperature_2m_max[0]);
                const lowTemp = Math.round(daily.temperature_2m_min[0]);
                const uvIndex = Math.round(daily.uv_index_max[0]);
                const uvInfo = getUVLevel(uvIndex);
                const precipProb = daily.precipitation_probability_max[0];
                const sunrise = formatSunTime(daily.sunrise[0]);
                const sunset = formatSunTime(daily.sunset[0]);
                
                const hourlyForecast = getHourlyForecast(weather);
                
                const { recommendations, alerts } = getGearRecommendations(
                    temp, feelsLike, windSpeed, precipitation, weatherCode, humidity
                );

                app.innerHTML = `
                    <div class="card">
                        <div class="location">${location.name}</div>
                        <div class="conditions">${conditions}</div>
                        <div class="weather-main">
                            <div class="temp-display">${temp}¬∞F</div>
                            <div class="weather-details">
                                <div>Feels like: ${feelsLike}¬∞F</div>
                                <div>High: ${highTemp}¬∞F / Low: ${lowTemp}¬∞F</div>
                                <div class="wind-info">Wind: ${windArrow} ${windSpeed} mph ${windDir}</div>
                                ${windGust > windSpeed + 5 ? `<div style="color: #e67e22;">Gusts: ${windGust} mph</div>` : ''}
                            </div>
                        </div>
                    </div>

                    ${alerts.map(alert => {
                        const isDanger = alert.includes('Extreme') || alert.includes('Snow');
                        return `<div class="alert ${isDanger ? 'danger' : ''}">${alert}</div>`;
                    }).join('')}

                    <div class="card">
                        <div class="section-title">üß• Recommended Gear</div>
                        
                        <div class="gear-item">
                            <div class="gear-category">Upper Body</div>
                            <div class="gear-recommendation">${recommendations.upperBody}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Lower Body</div>
                            <div class="gear-recommendation">${recommendations.lowerBody}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Gloves</div>
                            <div class="gear-recommendation">${recommendations.gloves}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Footwear</div>
                            <div class="gear-recommendation">${recommendations.footwear}</div>
                        </div>

                        ${recommendations.accessories.length > 0 ? `
                            <div class="gear-item">
                                <div class="gear-category">Accessories</div>
                                <div class="gear-recommendation">${recommendations.accessories.join(', ')}</div>
                            </div>
                        ` : ''}
                    </div>

                    <div class="card">
                        <div class="section-title">‚è∞ Next 6 Hours</div>
                        <div class="hourly-forecast">
                            ${hourlyForecast.map(hour => `
                                <div class="hourly-item">
                                    <div class="hourly-time">${formatTime(hour.time)}</div>
                                    <div class="hourly-temp">${hour.temp}¬∞</div>
                                    <div class="hourly-details">Feels ${hour.feelsLike}¬∞</div>
                                    ${hour.precipProb > 20 ? `<div class="hourly-details" style="color: #17a2b8;">${hour.precipProb}% rain</div>` : ''}
                                    ${hour.windGust > 15 ? `<div class="hourly-details" style="color: #e67e22;">Gust ${hour.windGust}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <div class="section-title">‚òÄÔ∏è Additional Details</div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">UV Index</div>
                                <div class="info-value ${uvInfo.class}">${uvIndex} - ${uvInfo.level}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Rain Chance</div>
                                <div class="info-value">${precipProb}%</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Sunrise</div>
                                <div class="info-value">${sunrise}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Sunset</div>
                                <div class="info-value">${sunset}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Humidity</div>
                                <div class="info-value">${humidity}%</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Wind Gusts</div>
                                <div class="info-value">${windGust} mph</div>
                            </div>
                        </div>

                        ${uvIndex >= 6 ? `
                            <div class="alert info" style="margin-top: 15px;">
                                ‚òÄÔ∏è High UV - Apply sunscreen (SPF 30+) and consider UV-protective clothing
                            </div>
                        ` : ''}
                    </div>

                    <button class="refresh-btn" onclick="loadApp()">üîÑ Refresh Weather</button>
                `;
                
            } catch (error) {
                app.innerHTML = `
                    <div class="error">
                        <strong>Error loading weather data</strong><br>
                        ${error.message}
                    </div>
                    <button class="refresh-btn" onclick="loadApp()">Try Again</button>
                `;
            }
        }

        loadApp();
    </script>
</body>
</html>
