<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Cycling Weather Gear</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .temp-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }

        .weather-details {
            text-align: right;
        }

        .weather-details div {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .location {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .conditions {
            font-size: 14px;
            color: #666;
            text-transform: capitalize;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .gear-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .gear-category {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .gear-recommendation {
            color: #555;
            font-size: 14px;
        }

        .alert {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .alert.danger {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }

        .refresh-btn:active {
            background: #5568d3;
        }

        .wind-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wind-arrow {
            display: inline-block;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö¥ Cycling Weather</h1>
            <p>What to wear for your ride</p>
        </div>

        <div id="app">
            <div class="loading">Loading weather data...</div>
        </div>
    </div>

    <script>
        const LUBBOCK_COORDS = { lat: 33.5779, lon: -101.8552 };

        async function getWeather(lat, lon) {
            // Using Open-Meteo API - free, no API key needed, CORS-friendly
            const response = await fetch(
                `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_direction_10m&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto&forecast_days=1`
            );
            return await response.json();
        }

        async function getLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            resolve({
                                lat: position.coords.latitude,
                                lon: position.coords.longitude,
                                name: 'Your Location'
                            });
                        },
                        () => {
                            resolve({
                                ...LUBBOCK_COORDS,
                                name: 'Lubbock, TX'
                            });
                        }
                    );
                } else {
                    resolve({
                        ...LUBBOCK_COORDS,
                        name: 'Lubbock, TX'
                    });
                }
            });
        }

        function getWeatherDescription(code) {
            const weatherCodes = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Foggy',
                51: 'Light drizzle',
                53: 'Drizzle',
                55: 'Heavy drizzle',
                61: 'Light rain',
                63: 'Rain',
                65: 'Heavy rain',
                71: 'Light snow',
                73: 'Snow',
                75: 'Heavy snow',
                80: 'Rain showers',
                95: 'Thunderstorm'
            };
            return weatherCodes[code] || 'Unknown';
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        function getWindArrow(degrees) {
            // Rotate arrow to point in wind direction
            const rotation = degrees + 180; // Add 180 to point where wind is going
            return `<span style="display: inline-block; transform: rotate(${rotation}deg);">‚Üë</span>`;
        }

        function getGearRecommendations(temp, feelsLike, windSpeed, precipitation, weatherCode) {
            const recommendations = {
                upperBody: '',
                lowerBody: '',
                gloves: '',
                footwear: '',
                accessories: []
            };

            const alerts = [];

            // Determine effective temperature (use feels-like for cold, actual for warm)
            const effectiveTemp = temp < 60 ? feelsLike : temp;

            // UPPER BODY
            if (effectiveTemp < 25) {
                recommendations.upperBody = 'Base layer + thermal jersey + winter jacket (insulated, windproof)';
            } else if (effectiveTemp < 35) {
                recommendations.upperBody = 'Base layer + long sleeve jersey + winter jacket';
            } else if (effectiveTemp < 45) {
                recommendations.upperBody = 'Base layer + long sleeve jersey + windproof jacket';
            } else if (effectiveTemp < 55) {
                recommendations.upperBody = 'Long sleeve jersey + windproof vest or jacket';
            } else if (effectiveTemp < 65) {
                recommendations.upperBody = 'Long sleeve jersey or short sleeve + arm warmers';
            } else if (effectiveTemp < 75) {
                recommendations.upperBody = 'Short sleeve jersey';
            } else {
                recommendations.upperBody = 'Lightweight/mesh jersey';
                recommendations.accessories.push('Extra water bottle');
                recommendations.accessories.push('Sunscreen');
            }

            // LOWER BODY
            if (effectiveTemp < 30) {
                recommendations.lowerBody = 'Thermal tights (windproof front)';
            } else if (effectiveTemp < 40) {
                recommendations.lowerBody = 'Thermal tights or knickers + leg warmers';
            } else if (effectiveTemp < 50) {
                recommendations.lowerBody = 'Knickers or shorts + leg warmers';
            } else if (effectiveTemp < 60) {
                recommendations.lowerBody = 'Shorts + knee warmers or light leg warmers';
            } else {
                recommendations.lowerBody = 'Cycling shorts/bibs';
            }

            // GLOVES
            if (effectiveTemp < 20) {
                recommendations.gloves = 'Lobster mitts or pogies';
                alerts.push('‚ö†Ô∏è Extreme cold - consider shortening ride or indoor trainer');
            } else if (effectiveTemp < 30) {
                recommendations.gloves = 'Winter gloves (insulated, windproof)';
            } else if (effectiveTemp < 40) {
                recommendations.gloves = 'Heavy winter gloves';
            } else if (effectiveTemp < 50) {
                recommendations.gloves = 'Light winter gloves or windproof gloves';
            } else if (effectiveTemp < 60) {
                recommendations.gloves = 'Light full-finger gloves';
            } else if (effectiveTemp < 70) {
                recommendations.gloves = 'Fingerless gloves (optional)';
            } else {
                recommendations.gloves = 'None needed (or fingerless for padding)';
            }

            // FOOTWEAR
            if (effectiveTemp < 30) {
                recommendations.footwear = 'Winter cycling boots + wool socks';
            } else if (effectiveTemp < 40) {
                recommendations.footwear = 'Shoe covers (neoprene/insulated) + wool socks';
            } else if (effectiveTemp < 50) {
                recommendations.footwear = 'Toe covers or light shoe covers';
            } else if (effectiveTemp < 60) {
                recommendations.footwear = 'Regular shoes (consider toe covers)';
            } else {
                recommendations.footwear = 'Regular cycling shoes';
            }

            // ACCESSORIES
            if (effectiveTemp < 40) {
                recommendations.accessories.push('Neck gaiter or balaclava');
                recommendations.accessories.push('Skull cap under helmet');
            } else if (effectiveTemp < 50) {
                recommendations.accessories.push('Ear warmers or headband');
            }

            if (windSpeed > 20) {
                alerts.push('‚ö†Ô∏è High winds - expect significant wind chill and difficult riding');
                if (!recommendations.upperBody.includes('windproof')) {
                    recommendations.accessories.push('Consider windproof layer');
                }
            } else if (windSpeed > 15) {
                alerts.push('Moderate winds - wind chill will be significant');
            }

            if (precipitation > 0 || weatherCode >= 51) {
                recommendations.accessories.push('Rain jacket or vest');
                recommendations.accessories.push('Fenders recommended');
                if (weatherCode >= 61) {
                    alerts.push('üåßÔ∏è Rain expected - wear waterproof layers');
                }
            }

            if (weatherCode >= 71 && weatherCode <= 75) {
                alerts.push('‚ùÑÔ∏è Snow conditions - consider indoor trainer');
            }

            if (temp > 85) {
                alerts.push('üå°Ô∏è High heat - hydrate well, consider earlier/later ride time');
            }

            return { recommendations, alerts };
        }

        async function loadApp() {
            const app = document.getElementById('app');
            
            try {
                const location = await getLocation();
                const weather = await getWeather(location.lat, location.lon);
                
                const current = weather.current;
                const daily = weather.daily;
                
                const temp = Math.round(current.temperature_2m);
                const feelsLike = Math.round(current.apparent_temperature);
                const windSpeed = Math.round(current.wind_speed_10m);
                const windDir = getWindDirection(current.wind_direction_10m);
                const windArrow = getWindArrow(current.wind_direction_10m);
                const precipitation = current.precipitation || 0;
                const weatherCode = current.weather_code;
                const conditions = getWeatherDescription(weatherCode);
                const highTemp = Math.round(daily.temperature_2m_max[0]);
                const lowTemp = Math.round(daily.temperature_2m_min[0]);
                
                const { recommendations, alerts } = getGearRecommendations(
                    temp, feelsLike, windSpeed, precipitation, weatherCode
                );

                app.innerHTML = `
                    <div class="card">
                        <div class="location">${location.name}</div>
                        <div class="conditions">${conditions}</div>
                        <div class="weather-main">
                            <div class="temp-display">${temp}¬∞F</div>
                            <div class="weather-details">
                                <div>Feels like: ${feelsLike}¬∞F</div>
                                <div>High: ${highTemp}¬∞F / Low: ${lowTemp}¬∞F</div>
                                <div class="wind-info">Wind: ${windArrow} ${windSpeed} mph ${windDir}</div>
                            </div>
                        </div>
                    </div>

                    ${alerts.map(alert => {
                        const isDanger = alert.includes('Extreme') || alert.includes('Snow');
                        return `<div class="alert ${isDanger ? 'danger' : ''}">${alert}</div>`;
                    }).join('')}

                    <div class="card">
                        <div class="section-title">üß• Recommended Gear</div>
                        
                        <div class="gear-item">
                            <div class="gear-category">Upper Body</div>
                            <div class="gear-recommendation">${recommendations.upperBody}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Lower Body</div>
                            <div class="gear-recommendation">${recommendations.lowerBody}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Gloves</div>
                            <div class="gear-recommendation">${recommendations.gloves}</div>
                        </div>

                        <div class="gear-item">
                            <div class="gear-category">Footwear</div>
                            <div class="gear-recommendation">${recommendations.footwear}</div>
                        </div>

                        ${recommendations.accessories.length > 0 ? `
                            <div class="gear-item">
                                <div class="gear-category">Accessories</div>
                                <div class="gear-recommendation">${recommendations.accessories.join(', ')}</div>
                            </div>
                        ` : ''}
                    </div>

                    <button class="refresh-btn" onclick="loadApp()">üîÑ Refresh Weather</button>
                `;
                
            } catch (error) {
                app.innerHTML = `
                    <div class="error">
                        <strong>Error loading weather data</strong><br>
                        ${error.message}
                    </div>
                    <button class="refresh-btn" onclick="loadApp()">Try Again</button>
                `;
            }
        }

        loadApp();
    </script>
</body>
</html>
